# v2.6 Safety & Backup Plan
**Date:** 2025-10-21
**Purpose:** Ensure v2.6 remains 100% safe during modular architecture work

---

## Current State Protection

### Git Structure
```
Repository: /root/AlgoTrendy_v2.6/.git
â”œâ”€â”€ main branch (v2.6) â† PRODUCTION CODE - PROTECTED
â”œâ”€â”€ Other branches (phase1-6, development, etc.) â† Legacy branches
â””â”€â”€ Tags (to be created):
    â”œâ”€â”€ v2.6-baseline â† Snapshot before modular work
    â”œâ”€â”€ v2.6-safe â† Additional safety tag
    â””â”€â”€ pre-modular-architecture â† Descriptive bookmark
```

### What Gets Modified
- âœ… New files added (CHANGELOG.md, GitVersion.yml, etc.)
- âœ… .csproj files updated (add version properties)
- âœ… New workflows added (.github/workflows/)
- âŒ **NO existing functionality changed**
- âŒ **NO existing code logic altered**
- âŒ **NO breaking changes**

### What Stays Untouched
- âœ… All trading logic
- âœ… All broker implementations
- âœ… All data providers
- âœ… All tests
- âœ… All API endpoints
- âœ… Docker configurations
- âœ… Database schemas

---

## Safety Measures

### 1. Git Tags (Bookmarks)
Create multiple safety bookmarks:
```bash
# Tag current state as v2.6 baseline
git tag -a v2.6-baseline -m "v2.6 baseline before modular architecture work"

# Tag as safety checkpoint
git tag -a v2.6-safe -m "Safe rollback point for v2.6"

# Tag as pre-modular state
git tag -a pre-modular-architecture -m "State before creating modular branch"

# Push tags to remote (GitHub)
git push origin --tags
```

**Rollback command if needed:**
```bash
git reset --hard v2.6-baseline
```

---

### 2. Branch Protection
- `main` branch = v2.6 (ALWAYS safe)
- `modular` branch = v3.0 (new, experimental)

**Rule:** v2.6 development continues ONLY on `main`

---

### 3. Backup Locations

#### Primary: Git Tags
- Location: `.git/refs/tags/`
- Accessible via: `git tag -l`
- Rollback: `git reset --hard <tag-name>`

#### Secondary: GitHub Remote
- Location: `https://github.com/[your-repo]/AlgoTrendy_v2.6`
- All tags pushed to remote
- Can clone fresh copy anytime

#### Tertiary: Local Backup (Optional)
```bash
# Create a tarball backup
tar -czf ~/algotrendy-v2.6-backup-$(date +%Y%m%d).tar.gz \
  --exclude='.git' \
  --exclude='node_modules' \
  --exclude='bin' \
  --exclude='obj' \
  /root/AlgoTrendy_v2.6/

# Location: ~/algotrendy-v2.6-backup-20251021.tar.gz
```

---

## Rollback Procedures

### Scenario 1: Undo Last Few Commits
```bash
# See recent commits
git log --oneline -10

# Undo last commit (keep changes)
git reset --soft HEAD~1

# Undo last commit (discard changes)
git reset --hard HEAD~1
```

### Scenario 2: Complete Rollback to v2.6 Baseline
```bash
# Go back to tagged baseline
git reset --hard v2.6-baseline

# Force push if already pushed (BE CAREFUL)
git push origin main --force
```

### Scenario 3: Delete Modular Branch (Start Over)
```bash
# Delete local modular branch
git branch -D modular

# Delete remote modular branch
git push origin --delete modular

# v2.6 on main is untouched!
```

### Scenario 4: Fresh Start from GitHub
```bash
# Clone fresh copy from GitHub
cd /root
git clone https://github.com/[your-repo]/AlgoTrendy_v2.6 AlgoTrendy_v2.6_fresh

# Checkout baseline tag
cd AlgoTrendy_v2.6_fresh
git checkout v2.6-baseline
```

---

## What We'll Add to v2.6 (Low Risk)

### Phase 1: Module Versioning
**Files Added:**
- `GitVersion.yml` (new file)
- `backend/*/CHANGELOG.md` (8 new files)

**Files Modified:**
- `backend/*/*.csproj` (8 files - only add version properties)

**Risk Level:** ğŸŸ¢ Very Low
- No code logic changes
- Only metadata additions
- Build still works exactly the same

**Rollback:** Delete new files, revert .csproj changes

---

### Phase 2: Automated Releases
**Files Added:**
- `.github/workflows/release.yml` (new file)
- `.github/workflows/changelog.yml` (new file)
- `package.json` (new file, optional)

**Files Modified:**
- `README.md` (add versioning section)

**Risk Level:** ğŸŸ¢ Very Low
- GitHub Actions don't affect code
- Workflows only run on push
- Can disable workflows anytime

**Rollback:** Delete workflow files

---

### Phase 3: Modular Branch
**Files Added:**
- Everything in `modular` branch (separate branch!)

**Files Modified on main:**
- `.github/workflows/sync-to-modular.yml` (new file)

**Risk Level:** ğŸŸ¢ Very Low
- Separate branch (doesn't touch main)
- main branch unchanged
- Can delete branch anytime

**Rollback:** Delete modular branch

---

## Verification Checklist

Before each commit:
- [ ] Build succeeds: `dotnet build`
- [ ] Tests pass: `dotnet test`
- [ ] No functionality broken
- [ ] Can still deploy v2.6
- [ ] Can rollback if needed

After each phase:
- [ ] Create git tag
- [ ] Push to remote
- [ ] Verify v2.6 still works
- [ ] Document changes

---

## Emergency Procedures

### If Build Breaks
```bash
# Undo changes
git reset --hard HEAD~1

# Or go to baseline
git reset --hard v2.6-baseline

# Rebuild
dotnet clean
dotnet build
```

### If Tests Fail
```bash
# Check what changed
git diff HEAD~1

# Revert specific file
git checkout HEAD~1 -- path/to/file

# Or full rollback
git reset --hard v2.6-baseline
```

### If Deployment Breaks
```bash
# Deploy from baseline tag
git checkout v2.6-baseline
docker-compose up -d

# Or redeploy main branch
git checkout main
docker-compose up -d --force-recreate
```

---

## Communication Plan

### Before Starting
âœ… Create safety tags
âœ… Verify current state builds
âœ… Document rollback procedures
âœ… Commit all current work

### During Execution
âœ… Commit after each phase
âœ… Create tags at milestones
âœ… Test after each change
âœ… Report progress

### After Completion
âœ… Verify both branches work
âœ… Document final state
âœ… Update README
âœ… Celebrate!

---

## File System Layout

### Before (Current)
```
/root/AlgoTrendy_v2.6/
â”œâ”€â”€ backend/ (all v2.6 code)
â”œâ”€â”€ .git/
â”‚   â””â”€â”€ main branch
â””â”€â”€ (other directories)
```

### After Phase 1-2 (main branch enhanced)
```
/root/AlgoTrendy_v2.6/
â”œâ”€â”€ backend/ (same v2.6 code + version metadata)
â”œâ”€â”€ GitVersion.yml (new)
â”œâ”€â”€ .github/workflows/ (new workflows)
â”œâ”€â”€ .git/
â”‚   â”œâ”€â”€ main branch (v2.6 enhanced)
â”‚   â””â”€â”€ tags/
â”‚       â”œâ”€â”€ v2.6-baseline
â”‚       â””â”€â”€ v2.6-safe
â””â”€â”€ (other directories)
```

### After Phase 3 (modular branch added)
```
/root/AlgoTrendy_v2.6/
â”œâ”€â”€ [Same as above when on main branch]
â”œâ”€â”€ .git/
â”‚   â”œâ”€â”€ main branch (v2.6)
â”‚   â”œâ”€â”€ modular branch (v3.0) â† NEW
â”‚   â””â”€â”€ tags/
â”‚       â”œâ”€â”€ v2.6-baseline
â”‚       â”œâ”€â”€ v2.6-safe
â”‚       â””â”€â”€ pre-modular-architecture
```

**When you:** `git checkout main` â†’ You see v2.6
**When you:** `git checkout modular` â†’ You see v3.0

---

## Guarantees

### What I Guarantee
1. âœ… v2.6 code on `main` branch stays functional
2. âœ… Can rollback at any time
3. âœ… Tags created for safety
4. âœ… All changes are additive (no deletions)
5. âœ… Build and tests pass after each phase

### What I Don't Guarantee
1. âŒ Modular branch works perfectly first try (it's experimental)
2. âŒ Zero merge conflicts (rare, but possible)
3. âŒ No GitHub Actions failures (we'll fix them)

### What You Control
1. âœ… Approval before each phase
2. âœ… Can stop at any time
3. âœ… Can rollback at any time
4. âœ… Choose deployment (v2.6 or v3.0)

---

## Testing Strategy

### After Phase 1 (Version Infrastructure)
```bash
# Test build
dotnet build

# Should succeed with version numbers in output:
# "Building AlgoTrendy.Core 1.0.0"
# "Building AlgoTrendy.TradingEngine 1.0.0"
```

### After Phase 2 (Automated Releases)
```bash
# Test workflow syntax
yamllint .github/workflows/release.yml

# Test locally (if act installed)
act push -j release --dry-run
```

### After Phase 3 (Modular Architecture)
```bash
# Test monolith (main branch)
git checkout main
dotnet build
dotnet test
docker-compose up -d

# Test microservices (modular branch)
git checkout modular
docker-compose -f docker-compose.modular.yml build
docker-compose -f docker-compose.modular.yml up -d

# Both should work!
```

---

## Success Criteria

### Phase 1 Success
- [ ] v2.6 builds successfully
- [ ] All tests pass
- [ ] Version numbers appear in builds
- [ ] Can rollback to baseline

### Phase 2 Success
- [ ] v2.6 still builds
- [ ] GitHub Actions workflows valid
- [ ] Can create manual release
- [ ] Can rollback to baseline

### Phase 3 Success
- [ ] v2.6 on main works
- [ ] v3.0 on modular works
- [ ] Can switch between branches
- [ ] Auto-sync functional
- [ ] Can rollback to baseline

---

## Risk Assessment

| Action | Risk to v2.6 | Reversible | Time to Rollback |
|--------|--------------|-----------|------------------|
| Create tags | None | Yes | Instant |
| Add version to .csproj | Very Low | Yes | 5 minutes |
| Add CHANGELOG files | None | Yes | Instant |
| Add GitHub workflows | None | Yes | Instant |
| Create modular branch | **None** | Yes | Instant |
| Auto-sync workflow | Very Low | Yes | 5 minutes |

**Overall Risk to v2.6:** ğŸŸ¢ **Very Low**

---

## Ready to Proceed

### Pre-flight Checklist
- [x] v2.6 safety plan created
- [ ] Current work committed
- [ ] Safety tags created
- [ ] Rollback procedure documented
- [ ] Build verified
- [ ] Tests verified

**Once pre-flight complete, we can begin!**
